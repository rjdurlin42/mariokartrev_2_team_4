Team 4 – Mario Kart & Ride Replay Simulator

Team Members: Ray Durlin, Blake Pickett, Tyler Chittum, Benjamin Reed, and Sage Mooneyham

## Detail Design: Resistance System Control Circuit ##

Please note: the scope of this signoff extends only to the control cicuit itself, not to housing components or connectors. Also, the signoff document for the resistance system contains BOM listings and information redundant to this document.

### Function of the Subsystem:

- This subsytem acts to control the linear actuator used in the ride resistance system.
- Controls both the direction and speed of the linear actuator.
- Takes an input from the ride replay subsystem over a wireless connection, which determines the distance set point for the linear actuator.
- Takes an input from the linear actuator feedback to determine the current position of the actuator.

### Constraints:

#### Actuator Duty Cycle

The duty cycle of the utilized linear actuator is 25 %. This value must not be exeeded during normal operation.

#### Actuator Driving Voltage

The utilized actuator is rated for operation at 12 VDC. The control circuit must be capable of providing this volatage to the actuator.

#### Current Capability

The utilized actuator draws a stall current of 7 A, and has a nominal current draw from 1.1 A to 3.4 A. The control circuit must be capable of providing this current to the linear actuator without undergoing thermal overload. In addition, the utilized power connector must be capable of handling the total current demand.

#### Wireless Communications

The control ciruit must be capable of recieving a wirelessly-transmitted digital signal using Bluetooth.

#### Back-EMF Protection

In the course of operation, particularly when the motor comes to a halt after running, a transient voltage potential known as back-EMF will be generated by the motor with opposite polarity to its driving voltage. Due to this, the control cicuit must not be vulnerable to damage from transient reverse-polarization.

#### Mountability

The PCB layout must account for the need to mount the circuit within its housing.

#### Stability

The device must operate without becoming unstable.

#### Resolution

The device must be capable of providing at least 85 unique states, or lengths of extension.

### Schematic and PCB Layout

![Sc_Draft_3](https://user-images.githubusercontent.com/118228609/206243843-0c1c4a77-45d9-469f-8121-5443c982b23b.png)

Figure 1: a schematic for the control circuit.

![PCB_Draft_3](https://user-images.githubusercontent.com/118228609/206244811-3efdf8ed-f206-4d5d-87e2-98c0a601a7d4.png)

Figure 2: the PCB layout for the design.

The design files are included within the Electrical subdirectory of the Documentation directory. See links: [schematic](https://github.com/rjdurlin42/mariokartrev_2_team_4/blob/main/Documentation/Electrical/Ride%20Resistance%20System%20Control%20Circuit.png), [pcb](https://github.com/rjdurlin42/mariokartrev_2_team_4/tree/main/Documentation/Electrical/PCB/Sources/Ride%20Resistance%20System%20Control%20Circuit).

### Analysis

Table 1: analysis of selected components and constraint-based design considerations.
|     Component(s)                                                                            |     Design   Considerations                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|---------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|     Switching Transistors (Q1, Q2, Q3, Q4)                                                  |     Q1 and Q2 are rated to handle continuous current up to 24   A, while Q3 and Q4 are rated to handle continuous current up to 45 A; both   are well above the expected current requirement. Q1 and Q2 only need to   switch when the actuator changes direction, and a delay can be   programmatically implemented to ensure no current flows during the switching   of these transistors. However, Q3 and Q4 must be able to switch fast enough   to handle Pulse Width Modulation (PWM). These FETs have rise and fall times in   the order of tens of nanoseconds. As such, they should be capable of handling a PWM signal in the kHz range.             |
|     Back-EMF Protection Diodes (D1, D2, D3, D4)                                             |     These diodes are Schottky diodes with fast switching time   and very low forward voltage. Compared to the body diodes of the utilized   transistors (Vf ~ 1 V), these diodes provide a forward voltage of   equal to or less than 0.5 V, effectively bypassing the transistors during   reverse-conduction. These diodes are specified for use in free-wheeling   applications in the datasheet and are well-suited to handle the large   momentary current spikes produced by back-EMF, given that they are rated to   handle 100 A peak current.                                                                                                         |
|     Resistors (All)                                                                         |     All resistors in this circuit were subject to only very   small power dissipations: less than a milliwatt in all cases. As such, small,   common ¼ W resistors were selected. Gate resistors were selected to be   surface mount chip-resistors to minimize space usage. The gate driver   resistors for the P-Ch FETs are larger than those for the N-Ch FETs, as   switching speed is not a priority for the P-Ch FETs. The PWM will be done on   the N-Ch FETs, and it is vital that the voltage drop across the gate driver IC   be minimized to ensure complete biasing at steady-state.                                                              |
|     Pre-Biased Dual NPN IC (U1)                                                             |     This component is used to bias the gates of the P-Ch FETs,   as turning these transistors off will require a voltage of 12 V – a voltage   not achievable by using the microcontroller alone. This component was   selected because it combines the utility of four resistors and two BJTs into a   single package.                                                                                                                                                                                                                                                                                                                                        |
|     Arduino Nano (A1)                                                                       |     This microcontroller module was selected because it is   already in our stock. It provides an on-board voltage regulator capable of   regulating to 3.3 V and to 5 V. The 3.3 V supply is ideal for powering the   selected wireless module, while the 5 V supply is ideal for providing a   logic-voltage reference to the linear actuator feedback.    This microcontroller has a 10-bit DAC on board.                                                                                                                                                                                                                                                   |
|     Bluetooth Module                                                                        |     The HC06 module is an incredibly cheap Bluetooth module.   It should be capable of providing the required range, as it has a maximum   range of about 10 m. In addition to being inexpensive, this module also has   the benefit of being very easily connected; it requires only four pins to be   connected to the external circuit.                                                                                                                                                                                                                                                                                                                     |
|     Power Connector                                                                         |     The component handles the power input to the circuit,   which is then fed into the linear actuator. As such, it must be rated to   handle slightly over 7 amperes of current. An XT30 connector was selected, as this   type is rated for 15 A which is well over the expected current demand. It   does not allow the user to connect the polarity incorrectly. In addition, the   mating connector is commonly available in a form that lends itself to the   easy fabrication of cables of a custom length without any special equipment.              

To meet the mountability constraint, screw holes have been included in the PCB layout.

To meet the stability constraint, the Arduino microcontroller will be configured as a PID controller. A library exists to faciliate programming this functionality [1]. Pololu provides a configuration file for controlling their actuators which contains PID constants usable for controlling the device in a stable manner [2], so the work required to tune the controller will likely be minimal.

The practically-usable actuator length for our design has been determined to be 23 mm. The usable range was determined in the Resistance System signoff, and corresponds to a the range from 2-25 mm away from the flywheel. The 10-bit ADC allows for the full range of the actuator to be divided up into 1024 unique states. The full length of the actuator is 1.97" or 50.04 mm. 23 mm is 45.97 % of 50.04 mm, meaning this portion of the actuator's range corresponds to a 45.97 % of the total number of digital states detectable by the microcontroller; this value is floor[0.4597*1024] = 470. This number of unique states corresponds to a spatial (distance) precision of 23/470 = 0.04894 mm or 48.94 micrometers.

#### Abbreviation Definitions:

•	FET: field effect transistor

•	P-Ch: P-channel

•	N-Ch: N-channel

•	PWM: Pulse-width modulation

•	EMF: electromotive force; a potential difference

•	IC: integrated circuit

•	BJT: bipolar junction transistor


### Bill of Materials

Table 2: a BOM for the design. Please note that the Arduino Nano is already in our inventory.


|           Level           |      Part #     |                     Part Name                     |    Supplier   |  Supplier Part # | Qty |  Units | Unit Cost |   Cost  |
| ------------------------- | --------------- | ------------------------------------------------- | ------------- | ---------------- | --- | ------ | --------- | ------- |
| 1                         |    HBRIDGE100   |                      Assembly                     |      None     |       None       |  1  |  Assy  |           |         |
|            1.1            |     SOCK100     |                 DC Connector -Male                |      TME      |     XT30PW-M     |  1  |  Piece |   $0.63   |  $0.63  |
|            1.2            |    MOSFET100    |                       MOSFET                      |    DIGIKEY    |      G26P04K     |  2  |  Piece |   $0.78   |  $1.56  |
|            1.3            |    MOSFET101    |                       MOSFET                      |    DIGIKEY    |      AOD424      |  2  |  Piece |   $0.98   |  $1.96  |
|            1.4            |    WIFIREC100   |                Bluetooth Receiveer                |   ALIEXPRESS  |       HC-06      |  1  |  Piece |   $2.24   |  $2.24  |
|            1.5            |     DIODE100    |                       Diode                       |    DIGIKEY    |     B320-13-F    |  4  |  Piece |   $0.48   |  $1.92  |
|            1.6            |      BJT100     |                        BJT                        |    DIGIKEY    |   DDC114YU-7-F   |  1  |  Piece |   $0.43   |  $0.43  |
|            1.7            |   CHRESIST100   |                  10k Chip Resistor                |    DIGIKEY    | CRCW120610K0JNEA |  2  |  Piece |   $0.10   |  $0.20  |
|            1.8            |   CHRESIST101   |                  1k Chip Resistor                 |    DIGIKEY    |   ERJ-8GEYJ102V  |  2  |  Piece |   $0.14   |  $0.28  |
|            1.9            |  CARBRESIST100  |                    1k Resistor                    |    DIGIKEY    |  CFR-25JB-52-1K  |  3  |  Piece |   $0.01   |  $0.03  |
|            1.10           |  CARBRESIST101  |                   2.2k Resistor                   |    DIGIKEY    |  CFR-25JR-52-2K2 |  1  |  Piece |   $0.01   |  $0.01  |
|            1.11           |    ARDNANO100   |                    Arduino Nano                   |    Arduino    |      A000005     |  1  |  Piece |   $24.90  |  $24.90 |
|                           |                 |                                                   |               |                  |     |        |   Total   |  $34.16 |

### Citations

[1]B. Beauregard, “Arduino PID Library,” Arduino Playground. [Online]. Available: https://playground.arduino.cc/Code/PIDLibrary/. [Accessed: 08-Dec-2022]. 

[2]“Pololu - Glideforce GF23-120502-3-65 high-speed LD linear actuator with feedback: 12kgf, 2’ stroke (1.97’ usable), 3.3’/s, 12V,” Pololu Robotics &amp; Electronics. [Online]. Available: https://www.pololu.com/product/4951. [Accessed: 08-Dec-2022]. 
